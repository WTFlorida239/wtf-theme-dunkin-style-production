{% comment %}
  Section: social-wall.liquid
  Social media wall with Instagram, TikTok, and YouTube feeds
  Instagram: @wtfswagbrand (Business Account)
{% endcomment %}

<section class="social-wall" data-section-id="{{ section.id }}">
  <div class="social-wall__container page-width">
    <div class="social-wall__header">
      <h2 class="social-wall__title">{{ section.settings.title | default: 'Follow Our Vibe' }}</h2>
      <p class="social-wall__subtitle">{{ section.settings.subtitle | default: 'Stay connected with our community' }}</p>
      
      <!-- Social Platform Filters -->
      <div class="social-filters">
        <button class="social-filter social-filter--active" data-filter="all">
          All
        </button>
        <button class="social-filter" data-filter="instagram">
          <svg class="social-filter__icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1 1 12.324 0 6.162 6.162 0 0 1-12.324 0zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm4.965-10.405a1.44 1.44 0 1 1 2.881.001 1.44 1.44 0 0 1-2.881-.001z"/>
          </svg>
          Instagram
        </button>
        <button class="social-filter" data-filter="tiktok">
          <svg class="social-filter__icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
          </svg>
          TikTok
        </button>
        <button class="social-filter" data-filter="youtube">
          <svg class="social-filter__icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
          </svg>
          YouTube
        </button>
      </div>
    </div>

    <!-- Social Feed Grid -->
    <div class="social-grid" data-social-grid>
      <!-- Posts will be dynamically loaded here -->
      <div class="social-grid__loading">
        <div class="spinner"></div>
        <p>Loading social feeds...</p>
      </div>
    </div>

    <!-- Load More Button -->
    <div class="social-wall__footer">
      <button class="btn btn--secondary" data-load-more style="display: none;">
        Load More
      </button>
    </div>

    <!-- Moderation Panel (Admin Only) -->
    {% if request.design_mode %}
      <div class="moderation-panel">
        <h3>Moderation Controls</h3>
        <div class="moderation-controls">
          <label class="moderation-toggle">
            <input type="checkbox" data-mod-instagram checked>
            <span>Show Instagram</span>
          </label>
          <label class="moderation-toggle">
            <input type="checkbox" data-mod-tiktok checked>
            <span>Show TikTok</span>
          </label>
          <label class="moderation-toggle">
            <input type="checkbox" data-mod-youtube checked>
            <span>Show YouTube</span>
          </label>
        </div>
        <button class="btn btn--small" data-refresh-feeds>Refresh Feeds</button>
      </div>
    {% endif %}
  </div>
</section>

<!-- Social Post Template -->
<template id="social-post-template">
  <article class="social-post" data-platform="" data-post-id="">
    <div class="social-post__header">
      <div class="social-post__platform">
        <span class="social-post__platform-icon"></span>
        <span class="social-post__platform-name"></span>
      </div>
      <time class="social-post__time"></time>
    </div>
    
    <div class="social-post__media">
      <!-- Image or Video -->
    </div>
    
    <div class="social-post__content">
      <p class="social-post__caption"></p>
      
      <div class="social-post__stats">
        <span class="social-post__stat">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
          </svg>
          <span class="social-post__likes">0</span>
        </span>
        <span class="social-post__stat">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
          </svg>
          <span class="social-post__views">0</span>
        </span>
      </div>
    </div>
    
    <a href="" class="social-post__link" target="_blank" rel="noopener">
      View on <span class="social-post__link-platform"></span>
    </a>
  </article>
</template>

<style>
  .social-wall {
    padding: 60px 0;
    background: white;
  }
  
  .social-wall__container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  .social-wall__header {
    text-align: center;
    margin-bottom: 40px;
  }
  
  .social-wall__title {
    font-size: 36px;
    font-weight: bold;
    color: #212529;
    margin-bottom: 10px;
  }
  
  .social-wall__subtitle {
    font-size: 18px;
    color: #6c757d;
    margin-bottom: 30px;
  }
  
  /* Social Filters */
  .social-filters {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .social-filter {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: white;
    border: 2px solid #dee2e6;
    border-radius: 25px;
    font-size: 14px;
    font-weight: 600;
    color: #495057;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .social-filter:hover {
    border-color: {{ settings.color_primary | default: '#ff6600' }};
    transform: translateY(-2px);
  }
  
  .social-filter--active {
    background: {{ settings.color_primary | default: '#ff6600' }};
    border-color: {{ settings.color_primary | default: '#ff6600' }};
    color: white;
  }
  
  .social-filter__icon {
    width: 20px;
    height: 20px;
  }
  
  /* Social Grid */
  .social-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
    min-height: 400px;
  }
  
  .social-grid__loading {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px 20px;
  }
  
  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid {{ settings.color_primary | default: '#ff6600' }};
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  /* Social Post Card */
  .social-post {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
  }
  
  .social-post:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
  }
  
  .social-post__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid #e9ecef;
  }
  
  .social-post__platform {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 600;
  }
  
  .social-post__platform-icon {
    width: 20px;
    height: 20px;
  }
  
  .social-post[data-platform="instagram"] .social-post__platform-icon {
    background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    border-radius: 6px;
  }
  
  .social-post[data-platform="tiktok"] .social-post__platform-icon {
    background: #000;
    border-radius: 4px;
  }
  
  .social-post[data-platform="youtube"] .social-post__platform-icon {
    background: #FF0000;
    border-radius: 4px;
  }
  
  .social-post__time {
    font-size: 12px;
    color: #6c757d;
  }
  
  .social-post__media {
    position: relative;
    padding-bottom: 100%; /* 1:1 Aspect Ratio */
    overflow: hidden;
    background: #f8f9fa;
  }
  
  .social-post__media img,
  .social-post__media video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .social-post__media-type {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
  }
  
  .social-post__content {
    padding: 16px;
    flex: 1;
  }
  
  .social-post__caption {
    font-size: 14px;
    line-height: 1.5;
    color: #212529;
    margin-bottom: 12px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .social-post__stats {
    display: flex;
    gap: 16px;
    font-size: 13px;
    color: #6c757d;
  }
  
  .social-post__stat {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  
  .social-post__stat svg {
    opacity: 0.7;
  }
  
  .social-post__link {
    display: block;
    padding: 12px 16px;
    background: #f8f9fa;
    text-align: center;
    text-decoration: none;
    color: {{ settings.color_primary | default: '#ff6600' }};
    font-size: 14px;
    font-weight: 600;
    transition: background 0.2s;
  }
  
  .social-post__link:hover {
    background: #e9ecef;
  }
  
  /* Load More */
  .social-wall__footer {
    text-align: center;
  }
  
  /* Moderation Panel */
  .moderation-panel {
    margin-top: 40px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 2px dashed #dee2e6;
  }
  
  .moderation-panel h3 {
    font-size: 16px;
    margin-bottom: 15px;
  }
  
  .moderation-controls {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }
  
  .moderation-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
  }
  
  .moderation-toggle input {
    cursor: pointer;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .social-grid {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .social-wall__title {
      font-size: 28px;
    }
    
    .social-filters {
      gap: 8px;
    }
    
    .social-filter {
      padding: 6px 12px;
      font-size: 13px;
    }
  }
  
  @media (min-width: 1200px) {
    .social-grid {
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
  }
</style>

<script>
  // Social Wall Manager
  document.addEventListener('DOMContentLoaded', function() {
    const socialWall = {
      feeds: {
        instagram: {
          username: 'wtfswagbrand',
          enabled: true,
          posts: []
        },
        tiktok: {
          username: 'wtfswagbrand',
          enabled: true,
          posts: []
        },
        youtube: {
          channelId: '',
          enabled: true,
          posts: []
        }
      },
      currentFilter: 'all',
      postsPerLoad: 12,
      currentPage: 0,
      
      init() {
        this.bindEvents();
        this.loadFeeds();
      },
      
      bindEvents() {
        // Filter buttons
        document.querySelectorAll('[data-filter]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            this.setFilter(e.target.dataset.filter);
          });
        });
        
        // Load more
        const loadMoreBtn = document.querySelector('[data-load-more]');
        if (loadMoreBtn) {
          loadMoreBtn.addEventListener('click', () => this.loadMore());
        }
        
        // Moderation toggles
        document.querySelectorAll('[data-mod-instagram], [data-mod-tiktok], [data-mod-youtube]').forEach(toggle => {
          toggle.addEventListener('change', (e) => {
            const platform = e.target.dataset.modInstagram ? 'instagram' :
                            e.target.dataset.modTiktok ? 'tiktok' : 'youtube';
            this.feeds[platform].enabled = e.target.checked;
            this.renderPosts();
          });
        });
        
        // Refresh feeds
        const refreshBtn = document.querySelector('[data-refresh-feeds]');
        if (refreshBtn) {
          refreshBtn.addEventListener('click', () => this.loadFeeds(true));
        }
      },
      
      setFilter(filter) {
        this.currentFilter = filter;
        this.currentPage = 0;
        
        // Update button states
        document.querySelectorAll('[data-filter]').forEach(btn => {
          btn.classList.toggle('social-filter--active', btn.dataset.filter === filter);
        });
        
        this.renderPosts();
      },
      
      async loadFeeds(force = false) {
        const grid = document.querySelector('[data-social-grid]');
        const loading = grid.querySelector('.social-grid__loading');
        
        // Show loading state
        if (loading) loading.style.display = 'block';
        
        try {
          // In production, these would be actual API calls
          // For now, we'll simulate with sample data
          await this.loadInstagramFeed();
          await this.loadTikTokFeed();
          await this.loadYouTubeFeed();
          
          this.renderPosts();
        } catch (error) {
          console.error('Failed to load social feeds:', error);
        } finally {
          if (loading) loading.style.display = 'none';
        }
      },
      
      async loadInstagramFeed() {
        // Simulated Instagram API call
        // In production: Use Instagram Graph API
        this.feeds.instagram.posts = [
          {
            id: 'ig_1',
            type: 'image',
            media_url: 'https://images.unsplash.com/photo-1607290817806-e93c813ff329?w=400',
            caption: 'Fresh Kava vibes at WTF! Come try our new tropical flavors 🌴',
            permalink: 'https://instagram.com/p/example1',
            timestamp: new Date(Date.now() - 86400000).toISOString(),
            likes: 245,
            comments: 18
          },
          {
            id: 'ig_2',
            type: 'video',
            media_url: 'https://images.unsplash.com/photo-1609951651556-5334e2706168?w=400',
            caption: 'Making the perfect Kratom tea blend ☕',
            permalink: 'https://instagram.com/p/example2',
            timestamp: new Date(Date.now() - 172800000).toISOString(),
            likes: 189,
            views: 1523
          },
          {
            id: 'ig_3',
            type: 'image',
            media_url: 'https://images.unsplash.com/photo-1625772299848-391b6a87d7b3?w=400',
            caption: 'Delta-9 drinks now available! Legal and delicious 🍹',
            permalink: 'https://instagram.com/p/example3',
            timestamp: new Date(Date.now() - 259200000).toISOString(),
            likes: 412,
            comments: 34
          }
        ];
      },
      
      async loadTikTokFeed() {
        // Simulated TikTok API call
        this.feeds.tiktok.posts = [
          {
            id: 'tt_1',
            type: 'video',
            media_url: 'https://images.unsplash.com/photo-1541167760496-1628856ab772?w=400',
            caption: 'Day in the life at WTF Kava Bar #kavaculture #florida',
            permalink: 'https://tiktok.com/@wtfswagbrand/video/example1',
            timestamp: new Date(Date.now() - 43200000).toISOString(),
            likes: 3421,
            views: 28500
          }
        ];
      },
      
      async loadYouTubeFeed() {
        // Simulated YouTube API call
        this.feeds.youtube.posts = [
          {
            id: 'yt_1',
            type: 'video',
            media_url: 'https://images.unsplash.com/photo-1598387180437-80388ae0df12?w=400',
            caption: 'What is Kava? Everything you need to know!',
            permalink: 'https://youtube.com/watch?v=example1',
            timestamp: new Date(Date.now() - 604800000).toISOString(),
            likes: 156,
            views: 4200
          }
        ];
      },
      
      renderPosts() {
        const grid = document.querySelector('[data-social-grid]');
        const template = document.getElementById('social-post-template');
        
        if (!grid || !template) return;
        
        // Clear existing posts
        grid.innerHTML = '';
        
        // Combine and filter posts
        let allPosts = [];
        
        Object.entries(this.feeds).forEach(([platform, feed]) => {
          if (feed.enabled && (this.currentFilter === 'all' || this.currentFilter === platform)) {
            allPosts = allPosts.concat(feed.posts.map(post => ({
              ...post,
              platform
            })));
          }
        });
        
        // Sort by timestamp
        allPosts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        // Paginate
        const start = this.currentPage * this.postsPerLoad;
        const end = start + this.postsPerLoad;
        const postsToShow = allPosts.slice(0, end);
        
        // Render posts
        postsToShow.forEach(post => {
          const postEl = this.createPostElement(post, template);
          grid.appendChild(postEl);
        });
        
        // Show/hide load more button
        const loadMoreBtn = document.querySelector('[data-load-more]');
        if (loadMoreBtn) {
          loadMoreBtn.style.display = postsToShow.length < allPosts.length ? 'inline-block' : 'none';
        }
        
        // Show empty state if no posts
        if (postsToShow.length === 0) {
          grid.innerHTML = '<div class="social-grid__empty">No posts to display</div>';
        }
      },
      
      createPostElement(post, template) {
        const clone = template.content.cloneNode(true);
        const article = clone.querySelector('.social-post');
        
        // Set platform
        article.dataset.platform = post.platform;
        article.dataset.postId = post.id;
        
        // Platform info
        clone.querySelector('.social-post__platform-name').textContent = 
          post.platform.charAt(0).toUpperCase() + post.platform.slice(1);
        
        // Time
        const timeEl = clone.querySelector('.social-post__time');
        timeEl.textContent = this.formatTime(post.timestamp);
        
        // Media
        const mediaEl = clone.querySelector('.social-post__media');
        if (post.type === 'video') {
          mediaEl.innerHTML = `
            <img src="${post.media_url}" alt="${post.caption}" loading="lazy">
            <span class="social-post__media-type">Video</span>
          `;
        } else {
          mediaEl.innerHTML = `<img src="${post.media_url}" alt="${post.caption}" loading="lazy">`;
        }
        
        // Caption
        clone.querySelector('.social-post__caption').textContent = post.caption;
        
        // Stats
        if (post.likes) {
          clone.querySelector('.social-post__likes').textContent = this.formatNumber(post.likes);
        }
        if (post.views) {
          clone.querySelector('.social-post__views').textContent = this.formatNumber(post.views);
        }
        
        // Link
        const link = clone.querySelector('.social-post__link');
        link.href = post.permalink;
        clone.querySelector('.social-post__link-platform').textContent = 
          post.platform.charAt(0).toUpperCase() + post.platform.slice(1);
        
        return clone;
      },
      
      formatTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diff = (now - date) / 1000; // seconds
        
        if (diff < 3600) {
          return `${Math.floor(diff / 60)}m ago`;
        } else if (diff < 86400) {
          return `${Math.floor(diff / 3600)}h ago`;
        } else if (diff < 604800) {
          return `${Math.floor(diff / 86400)}d ago`;
        } else {
          return date.toLocaleDateString();
        }
      },
      
      formatNumber(num) {
        if (num >= 1000000) {
          return (num / 1000000).toFixed(1) + 'M';
        } else if (num >= 1000) {
          return (num / 1000).toFixed(1) + 'K';
        }
        return num.toString();
      },
      
      loadMore() {
        this.currentPage++;
        this.renderPosts();
      }
    };
    
    socialWall.init();
  });
</script>

{% schema %}
{
  "name": "Social Wall",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Follow Our Vibe"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Section Subtitle",
      "default": "Stay connected with our community"
    },
    {
      "type": "header",
      "content": "Instagram Settings"
    },
    {
      "type": "text",
      "id": "instagram_username",
      "label": "Instagram Username",
      "default": "wtfswagbrand",
      "info": "Business account username"
    },
    {
      "type": "text",
      "id": "instagram_token",
      "label": "Instagram Access Token",
      "info": "Required for Graph API"
    },
    {
      "type": "header",
      "content": "TikTok Settings"
    },
    {
      "type": "text",
      "id": "tiktok_username",
      "label": "TikTok Username",
      "default": "wtfswagbrand"
    },
    {
      "type": "header",
      "content": "YouTube Settings"
    },
    {
      "type": "text",
      "id": "youtube_channel_id",
      "label": "YouTube Channel ID"
    },
    {
      "type": "text",
      "id": "youtube_api_key",
      "label": "YouTube API Key"
    },
    {
      "type": "header",
      "content": "Display Settings"
    },
    {
      "type": "range",
      "id": "posts_per_page",
      "label": "Posts per page",
      "min": 6,
      "max": 24,
      "step": 3,
      "default": 12
    },
    {
      "type": "checkbox",
      "id": "auto_refresh",
      "label": "Auto-refresh feeds",
      "default": true,
      "info": "Refresh feeds every hour"
    }
  ],
  "presets": [
    {
      "name": "Social Wall"
    }
  ]
}
{% endschema %}