{%- comment -%}
  Reusable grouped flavor UI.
  Params:
    - scope: "kratom" | "kava" | "thc" (used only for IDs; lists below are editable)
    - id_prefix: optional, defaults to scope. Keeps IDs unique per page.
  Saves:
    properties[Flavor], properties[Flavor Category]
  Classes:
    .wtf-chip--flavor (selected gets .wtf-chip--active)
{%- endcomment -%}

{%- assign scope = scope | default: 'kratom' -%}
{%- assign id_prefix = id_prefix | default: scope -%}

{%- comment -%} Default lists (edit here if you like). You can later move to metafields. {%- endcomment -%}
{%- assign sugar_free = '
Blackberry,
White Chocolate,
Pumpkin Spice,
Lemon Spritz,
Vanilla,
Maple Bourbon Pecan,
Peach,
Simple Syrup,
Cosmopolitan,
Raspberry Lemonade,
Pomegranate,
Blueberry Lavender,
Salted Caramel,
Rose,
Mexican Chocolate
'
  | strip
  | newline_to_br
  | replace: '<br />', ','
  | split: ','
  | map: 'strip'
-%}

{%- assign regular = '
Caramel Apple Butter,
Lime,
Grenadine,
Dark Chocolate,
Margarita,
Brown Sugar,
Salted Chocolate Caramel,
Hibiscus Passion Fruit,
Blueberry,
Coconut Caramel (Samoa Cookie),
Cotton Candy
'
  | strip
  | newline_to_br
  | replace: '<br />', ','
  | split: ','
  | map: 'strip'
-%}

<section style="margin-bottom:14px;">
  <label style="display:block;font-weight:700;margin-bottom:8px;">Flavor</label>

  <!-- Hidden inputs saved to cart -->
  <input type="hidden" name="properties[Flavor]" id="{{ id_prefix }}Flavor">
  <input type="hidden" name="properties[Flavor Category]" id="{{ id_prefix }}FlavorCategory">

  <div id="{{ id_prefix }}-flavor-wrapper">
    <div style="font-weight:600;margin:.5rem 0 .25rem;">Sugar-Free Syrups</div>
    <div class="{{ id_prefix }}-chip-row" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px;">
      {%- for f in sugar_free -%}
        <button
          type="button"
          class="wtf-chip wtf-chip--flavor"
          data-flavor="{{ f | escape }}"
          data-group="Sugar Free"
        >
          {{ f }}
        </button>
      {%- endfor -%}
    </div>

    <div style="font-weight:600;margin:.5rem 0 .25rem;">Regular Sugar Syrups</div>
    <div class="{{ id_prefix }}-chip-row" style="display:flex;flex-wrap:wrap;gap:8px;">
      {%- for f in regular -%}
        <button
          type="button"
          class="wtf-chip wtf-chip--flavor"
          data-flavor="{{ f | escape }}"
          data-group="Regular"
        >
          {{ f }}
        </button>
      {%- endfor -%}
    </div>
  </div>
</section>

<style>
  .wtf-chip--flavor.wtf-chip--active {
    outline: 2px solid var(--color-accent, #ff6a00);
  }
</style>

<script>
  (function () {
    var wrap = document.getElementById('{{ id_prefix }}-flavor-wrapper');
    var flavorInput = document.getElementById('{{ id_prefix }}Flavor');
    var catInput = document.getElementById('{{ id_prefix }}FlavorCategory');
    if (!wrap || !flavorInput || !catInput) return;

    function setFlavor(btn) {
      var val = btn.getAttribute('data-flavor') || '';
      var grp = btn.getAttribute('data-group') || '';
      flavorInput.value = val;
      catInput.value = grp;
      wrap.querySelectorAll('.wtf-chip--flavor').forEach(function (b) {
        var active = b === btn;
        b.classList.toggle('wtf-chip--active', active);
        b.setAttribute('aria-checked', active ? 'true' : 'false');
      });
      document.dispatchEvent(new CustomEvent('wtf:flavor:selected', { detail: { flavor: val, category: grp } }));
    }

    var first = wrap.querySelector('.wtf-chip--flavor');
    if (first) setFlavor(first);

    wrap.addEventListener('click', function (e) {
      var btn = e.target.closest('.wtf-chip--flavor');
      if (btn) setFlavor(btn);
    });
  })();
</script>
